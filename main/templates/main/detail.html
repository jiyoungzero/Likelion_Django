{% extends 'base.html' %} {% block content %} {% load static%}

<h1 class="post_title" style="font-weight:bold;">{{post.title}}</h1>
{% if post.writer %}
    {% if 'user' in post.writer.username %}
        <h3>ì‘ì„±ìÂ : {{ post.writer.last_name }} {{ post.writer.first_name }}</h3>
    {% else %}
        <h3>ì‘ì„±ìÂ : {{ post.writer }}</h3>
    {% endif %}
{% else %}
    <h3>ì‘ì„±ìÂ : ì•Œ ìˆ˜ ì—†ìŒ</h3>
{% endif %}
ë‚ ì§œ : {{post.pub_date}}<br>
   {% comment %}  like  {% endcomment %}
   <span href="#" class="like" name ="{{post.id}}" value="Like">
    {% if user in post.like_user_set.all %}

            <i class="fa-solid fa-thumbs-up" id ="like-icon" style="color:red;"></i>

    {% else %}

            <i class="fa-regular fa-thumbs-up" id ="like-icon" style="color:red;"></i>

    {% endif %}
        <span id="count-{{ post.id }}" class="alt-services-title font-alt">
            ì¢‹ì•„ìš”
        {% if post.like_count == 0 %}
            0ê°œ
        {% else %}
            {{ post.like_count }}ê°œ
        {% endif %}
        </span>
 </span>

 {% comment %} dislike {% endcomment %}
 <span href="#" class="dislike" name ="{{post.id}}" value="Dislike">
    {% if user in post.dislike_user_set.all %}

            <i class="fa-solid fa-thumbs-down" id ="dislike-icon" style="color:blue;"></i>

    {% else %}

            <i class="fa-regular fa-thumbs-down" id ="dislike-icon" style="color:blue;"></i>

    {% endif %}
        <span id="count2-{{ post.id }}" class="alt-services-title font-alt">
            ì‹«ì–´ìš”
        {% if post.dislike_count == 0 %}
            0ê°œ
        {% else %}
            {{ post.dislike_count }}ê°œ
         {% endif %}
        </span>
 </span>

<hr />
{% if post.image %}
    <p><img src='{{ post.image.url }}' alt="ì‚¬ì§„"></p>
{% endif %}
<p>{{post.body}}</p>
<a href="{%  url 'main:edit' post.id %}">ê²Œì‹œê¸€ ìˆ˜ì •</a>
<a href="{%  url 'main:delete' post.id %}">ê²Œì‹œê¸€ ì‚­ì œ</a>
<hr>
<div>
    <form action="{% url 'main:create_comment' post.id %}" method="POST">
        {%csrf_token%}
        <textarea name="content" placeholder="ëŒ“ê¸€ë‚´ìš©ì…ë ¥"></textarea>
        <input type="submit" value="í™•ì¸">
    </form>
</div>
<hr>
<div>
     {% for comment in comments %}
    <div>
    ì‘ì„±ìÂ : {{comment.writer}}<br>
    {{comment.content}}    
    
    <a href="{%  url 'main:edit_comment' post.id comment.id %}">ëŒ“ê¸€ ìˆ˜ì •</a>
    <a href="{%  url 'main:delete_comment' comment.id %}">ëŒ“ê¸€ ì‚­ì œ</a>
     </div>
     <br>
    {% endfor %}
    <hr>
    <a href="{% url 'main:posts' %} ">âªì´ì „í˜ì´ì§€ë¡œ</a>

{% comment %} ê²Œì‹œê¸€/ëŒ“ê¸€ ìˆ˜ì •,ì‚­ì œ ê¶Œí•œ ë©”ì„¸ì§€ {% endcomment %}
    {% for message in messages %}
    <div class="alert {{ message.tags }} alert-auto-dismissible alert-dismissible notification-container text-center" role="alert">
            {% comment %} <span aria-hidden="true">&times;</span> {% endcomment %}
            ğŸš«{{ message }}ğŸš«
    </div>
    {% endfor %}


    </div>

{% comment %} ajax ì ìš©  {% endcomment %}
<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<script>
    $(".like").click(function(){
        var pk=$(this).attr('name')
        $.ajax({
            type:'POST',
            url:"{% url 'main:like_toggle' post.pk %}",
            data:{'pk':pk,'csrfmiddlewaretoken':'{{csrf_token}}'},
            dataType:'json',
            success:function(response){
                if(response.like_count==null){
                    alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                    window.location.replace('/accounts/login/');
                }
                else{
                    if(response.result=='like'){
                        $('#like-icon').removeClass();
                        $('#like-icon').addClass('fa-solid fa-thumbs-up');
                    }
                    else{
                        $('#like-icon').removeClass();
                        $('#like-icon').addClass('fa-regular fa-thumbs-up');
                    }
                    $('#count-{{post.id}}').html('ì¢‹ì•„ìš”'+response.like_count+"ê°œ");
                 }
            },
             error:function(request, status, error){
                alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.")
                alert('code:'+request.status+'\n'+'message:'+request.responseText+"\n"+"error:"+error);
            },
         })
    })


    $(".dislike").click(function(){
        var pk=$(this).attr('name')
        $.ajax({
            type:'POST',
            url:"{% url 'main:dislike_toggle' post.pk %}",
            data:{'pk':pk,'csrfmiddlewaretoken':'{{csrf_token}}'},
            dataType:'json',
            success:function(response){
                if(response.dislike_count==null){
                    alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                     window.location.replace('/accounts/login/');
                }
                else{
                    if(response.result=='dislike'){
                        $('#dislike-icon').removeClass();
                        $('#dislike-icon').addClass('fa-solid fa-thumbs-down');
                    }
                    else{
                        $('#dislike-icon').removeClass();
                        $('#dislike-icon').addClass('fa-regular fa-thumbs-down');
                     }
                    $('#count2-{{post.id}}').html('ì‹«ì–´ìš”'+response.dislike_count+"ê°œ");
                 }
            },
             error:function(request, status, error){
                alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.")
                alert('code:'+request.status+'\n'+'message:'+request.responseText+"\n"+"error:"+error);
            },
         })
    })
</script>
<hr>
{% endblock %}
